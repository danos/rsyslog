From: Michael Biebl <biebl@debian.org>
Date: Wed, 22 Jan 2020 15:37:38 +0100
Subject: Add missing test files

See https://github.com/rsyslog/rsyslog/issues/4146
---
 tests/imfile-escapelf.replacement-empty.sh | 30 ++++++++++++++++++++++++++++++
 tests/imfile-escapelf.replacement.sh       | 30 ++++++++++++++++++++++++++++++
 2 files changed, 60 insertions(+)
 create mode 100755 tests/imfile-escapelf.replacement-empty.sh
 create mode 100755 tests/imfile-escapelf.replacement.sh

diff --git a/tests/imfile-escapelf.replacement-empty.sh b/tests/imfile-escapelf.replacement-empty.sh
new file mode 100755
index 0000000..759c8a9
--- /dev/null
+++ b/tests/imfile-escapelf.replacement-empty.sh
@@ -0,0 +1,30 @@
+#!/bin/bash
+# Written in 2019 by Rainer Gerhards
+# This is part of the rsyslog testbench, licensed under ASL 2.0
+export QUEUE_EMPTY_CHECK_FUNC=wait_file_lines
+. ${srcdir:=.}/diag.sh init
+generate_conf
+add_conf '
+global(workDirectory="'${RSYSLOG_DYNNAME}'.spool")
+module(load="../plugins/imfile/.libs/imfile")
+input(type="imfile" ruleset="output" escapelf.replacement=""
+	File="./'$RSYSLOG_DYNNAME'.input" tag="file:" startmsg.regex="^msg")
+
+template(name="outfmt" type="string" string="%msg%\n")
+ruleset(name="output") {
+	action(type="omfile" file="'$RSYSLOG_OUT_LOG'" template="outfmt")
+}
+'
+# make sure file exists when rsyslog starts up
+echo 'msg 1 part 1
+ msg 1 part 2
+msg 2
+msg INVISIBLE by design' > $RSYSLOG_DYNNAME.input
+startup
+export NUMMESSAGES=2
+shutdown_when_empty
+wait_shutdown
+export EXPECTED='msg 1 part 1 msg 1 part 2
+msg 2'
+cmp_exact
+exit_test
diff --git a/tests/imfile-escapelf.replacement.sh b/tests/imfile-escapelf.replacement.sh
new file mode 100755
index 0000000..6039947
--- /dev/null
+++ b/tests/imfile-escapelf.replacement.sh
@@ -0,0 +1,30 @@
+#!/bin/bash
+# Written in 2019 by Rainer Gerhards
+# This is part of the rsyslog testbench, licensed under ASL 2.0
+export QUEUE_EMPTY_CHECK_FUNC=wait_file_lines
+. ${srcdir:=.}/diag.sh init
+generate_conf
+add_conf '
+global(workDirectory="'${RSYSLOG_DYNNAME}'.spool")
+module(load="../plugins/imfile/.libs/imfile")
+input(type="imfile" ruleset="output" escapelf.replacement="[LF]"
+	File="./'$RSYSLOG_DYNNAME'.input" tag="file:" startmsg.regex="^msg")
+
+template(name="outfmt" type="string" string="%msg%\n")
+ruleset(name="output") {
+	action(type="omfile" file="'$RSYSLOG_OUT_LOG'" template="outfmt")
+}
+'
+# make sure file exists when rsyslog starts up
+echo 'msg 1 part 1
+ msg 1 part 2
+msg 2
+msg INVISIBLE by design' > $RSYSLOG_DYNNAME.input
+startup
+export NUMMESSAGES=2
+shutdown_when_empty
+wait_shutdown
+export EXPECTED='msg 1 part 1[LF] msg 1 part 2
+msg 2'
+cmp_exact
+exit_test
